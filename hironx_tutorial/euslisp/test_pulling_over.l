(load "package://hrpsys_ros_bridge_tutorials/euslisp/hironxjsk-interface.l")
(hironxjsk-init)
(objects (list *hironxjsk*))

;; Look at table
(defun look-table ()
  (send *hironxjsk* :reset-manip-pose)
  (send *hironxjsk* :head :look-at
        (send (send (send *hironxjsk* :torso :end-coords :copy-worldcoords)
                    :translate #f(750 0 0)) :worldpos))
  (send *irtviewer* :draw-objects)  ;; Only for display
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 1000)
  (send *ri* :wait-interpolation))


(defun catch_rolled_egg ()
  ;;catch rolled_egg
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 -20))
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :hand-angle-vector :rhand #f(-15.449 15.449 15.449 -15.449))
  ;;(send *hironxjsk* :hand-angle-vector :rhand #f(-5.449 5.449 5.449 -5.449))
  (send *ri* :hand-angle-vector :rhand (send *hironxjsk* :hand-angle-vector :rhand) 2000)
  (ros::duration-sleep 5.0)
  ;;(send *hironxjsk* :rarm :move-end-pos #f(0 100 150) :world)
  (send *hironxjsk* :rarm :move-end-pos #f(0 200 170) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 -140))
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :hand-angle-vector :rhand #f(5.449 -5.449 5.449 -5.449))
  (send *ri* :hand-angle-vector :rhand (send *hironxjsk* :hand-angle-vector :rhand) 2000)
  (ros::duration-sleep 2.0)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 200) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 -300 0) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  ;;#f(-1.59088 -28.9354 -125.369 31.1713 60.0818 29.3499 0.6 0.0 -100.0 -15.2 9.4 -3.2 0.0 0.0 0.0)
  )

(defun place_rolled_egg ()
  (send *hironxjsk* :reset-manip-pose)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (catch_rolled_egg)
  ;;use tool
  ;; (ros::duration-sleep 1.0)
  ;;pull left
  (send *hironxjsk* :start-grasp :rhand)
  (send *ri* :hand-angle-vector :rhand (send *hironxjsk* :hand-angle-vector :rhand) 2000)
  (ros::duration-sleep 5.0)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 50) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(20 250 0) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 -80) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 80 0) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(25 0 50) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm_joint5 :joint-angle 62)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  ;;#f(42.7773 -30.3221 -106.774 19.7506 55.7145 63.5379 0.6 0.0 -100.0 -15.2 9.4 -3.2 0.0 0.0 0.0)
  ;;pull down
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 -50) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(-20 0 0) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 100) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 -400 0) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :stop-grasp :rarm)
  (send *ri* :hand-angle-vector :rhand (send *hironxjsk* :hand-angle-vector :rhand) 2000)
  (ros::duration-sleep 2.0)
  )

(defun place_egg_2 ()
  (send *hironxjsk* :reset-manip-pose)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation) 
  ;;catch
  (catch_rolled_egg)
  ;;use tool
  (send *hironxjsk* :start-grasp :rhand)
  (send *ri* :hand-angle-vector :rhand (send *hironxjsk* :hand-angle-vector :rhand) 2000)
  (ros::duration-sleep 5.0)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 50) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(20 250 0) :world)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm_joint5 :joint-angle 85)
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 55 0))
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 -80))
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(40 0 0))
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 -70 0))				      
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 100))
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm_joint5 :joint-angle -20)
  (send *hironxjsk* :rarm :move-end-pos #f(0 -50 0))
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(20 0 -100))
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 80 0))
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 10 0))
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 100))
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :rarm :move-end-pos #f(0 -400 0))
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  (send *hironxjsk* :stop-grasp :rhand)
  (send *ri* :hand-angle-vector :rhand (send *hironxjsk* :hand-angle-vector :rhand) 2000)
  (ros::duration-sleep 2.0)
  )

(defun main ()
  (place_rolled_egg)
  (place_egg_2)
  )
