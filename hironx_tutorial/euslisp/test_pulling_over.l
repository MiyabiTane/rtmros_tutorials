(load "package://hrpsys_ros_bridge_tutorials/euslisp/hironxjsk-interface.l")
(hironxjsk-init)
(objects (list *hironxjsk*))

;; Look at table
(defun look-table ()
  (send *hironxjsk* :stop-grasp :rarm)
  (send *ri* :hand-angle-vector :rhand (send *hironxjsk* :hand-angle-vector :rhand) 2000)
  (ros::duration-sleep 1.0)
  (send *hironxjsk* :reset-manip-pose)
  (send *hironxjsk* :head :look-at
        (send (send (send *hironxjsk* :torso :end-coords :copy-worldcoords)
                    :translate #f(500 0 0)) :worldpos))
  (send *irtviewer* :draw-objects)  ;; Only for display
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 1000)
  (send *ri* :wait-interpolation))


(defun send-robot ()
  (send *ri* :angle-vector (send *hironxjsk* :angle-vector) 2000)
  (send *ri* :wait-interpolation)
  )

(defun send-right-hand (sleep-time)
  (send *ri* :hand-angle-vector :rhand (send *hironxjsk* :hand-angle-vector :rhand) 2000)
  (ros::duration-sleep sleep-time)
  )


(defun catch_rolled_egg ()
  ;;catch rolled_egg
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 -10))
  (send-robot)
  (send *hironxjsk* :hand-angle-vector :rhand #f(-15.449 15.449 15.449 -15.449))
  ;;(send *hironxjsk* :hand-angle-vector :rhand #f(-5.449 5.449 5.449 -5.449))
  (send-right-hand 5.0)
  ;;(send *hironxjsk* :rarm :move-end-pos #f(0 100 150) :world)
  (send *hironxjsk* :rarm :move-end-pos #f(0 200 160) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 -140))
  (send-robot)
  (send *hironxjsk* :hand-angle-vector :rhand #f(5.449 -5.449 5.449 -5.449))
  (send-right-hand 2.0)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 200) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 -300 0) :world)
  (send-robot)
  ;;#f(-1.59088 -28.9354 -125.369 31.1713 60.0818 29.3499 0.6 0.0 -100.0 -15.2 9.4 -3.2 0.0 0.0 0.0)
  )


(defun place_rolled_egg ()
;;tamagoyaki ha omoi node guitte yattekara sukoshizutsu osu
;;oshisugitekara herawo hikimodosu
  (look-table)
  (catch_rolled_egg)
  ;;use tool
  ;; (ros::duration-sleep 1.0)
  ;;pull left
  (send *hironxjsk* :start-grasp :rhand)
  (send-right-hand 5.0)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 50) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(20 250 0) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 -80) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 30 0) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 60 0) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 10 0) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(25 0 50) :world)
  (send-robot)
  (send *hironxjsk* :rarm_joint5 :joint-angle 62)
  (send-robot)
  ;;#f(44.5356 -31.2902 -103.946 18.4616 54.3637 64.9728 0.6 0.0 -100.0 -15.2 9.4 -3.2 0.0 0.0 56.301)
  ;;pull down
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 -50) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(-40 0 0) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(20 0 0) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 100) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 -400 0) :world)
  (send-robot)
  (send *hironxjsk* :stop-grasp :rarm)
  (send-right-hand 2.0)
  )

(defun place_rolled_egg_2 ()
  (look-table)
  ;;catch
  (catch_rolled_egg)
  ;;use tool
  (send *hironxjsk* :start-grasp :rhand)
  (send-right-hand 5.0)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 50) :world)
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(20 250 0) :world)
  (send-robot)
  (send *hironxjsk* :rarm_joint5 :joint-angle 85)
  (send *hironxjsk* :rarm :move-end-pos #f(0 35 0))
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(50 0 -80))
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 -20 0))
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 -30 0))
  (send-robot)
  ;;(send *hironxjsk* :rarm :move-end-pos #f(0 -20 0))
  ;;(send-robot)
  ;;(send *hironxjsk* :rarm :move-end-pos #f(0 20 0))
  ;;(send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 100))
  (send-robot)
  (send *hironxjsk* :rarm_joint5 :joint-angle -20)
  (send *hironxjsk* :rarm :move-end-pos #f(15 -40 0))
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 -100))
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 20 0))
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 60 0))
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 20 0))
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 -20 0))
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 0 100))
  (send-robot)
  (send *hironxjsk* :rarm :move-end-pos #f(0 -400 0))
  (send-robot)
  (send *hironxjsk* :stop-grasp :rhand)
  (send-right-hand 2.0)
  )
  

(defun main ()
  (place_rolled_egg)
  (place_rolled_egg_2)
  )

